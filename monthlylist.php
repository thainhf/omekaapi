<?php//กำหนดค่า Access-Control-Allow-Origin ให้ เครื่อง อื่น ๆ สามารถเรียกใช้งานหน้านี้ได้header("Access-Control-Allow-Origin: *");header("Content-Type: application/json; charset=UTF-8");header("Access-Control-Allow-Methods: OPTIONS,GET,POST,PUT,DELETE");header("Access-Control-Max-Age: 3600");header("Access-Control-Allow-Headers: Content-Type, Access-Control-Allow-Headers, Authorization, X-Requested-With");?><?php$requestMethod = $_SERVER["REQUEST_METHOD"];include_once("custom_function.php");//==========================$config['omekas_url'] = 'https://omeka.p-set.org/api/';$config['omekas_url_item'] = 'https://omeka.p-set.org/s/Prawase/item/';$config['omekas_url_img'] = 'https://omeka.p-set.org/';$config['nd'] ="n.d.";$vconfig=$config;//==========================//ตรวจสอบหากใช้ Method GETif($requestMethod == 'GET'){   // crty=2023&crtm=04,05,06&limitpermonth=10    $dataArray= array();    //ตรวจสอบการส่งค่า id    if(isset($_GET['crty']) && !empty($_GET['crty'])){        $crty = $_GET['crty'];        $crtm = $_GET['crtm'];        $limitpermonth = $_GET['limitpermonth'];        if(!empty($limitpermonth)){            $vlimitpermonth=$limitpermonth;        }else{            $vlimitpermonth=100;        }        $vper_page= "&page=1&per_page=".$vlimitpermonth;        $vomekas_url= $config["omekas_url"];        $yyyy="";        $crtall="";        if(!empty($crty)){            $yyyy=$crty;            // $crtall=$crtall.$crty;        }else{            $yyyy="";            // $crtall=$crtall;        }        //  echo $crtall;        // $mm="";        if(!empty($crtm)){            $mm=$crtm;            //   $crtall=$crtall.'-'.$crtm;        }else{            $mm="";            //  $crtall=$crtall;        }        $mmArr = explode(",", $mm);        $i=0;        $j=0;        $vurl="";        foreach ($mmArr as $mm1) {            //  echo "<li>$mm</li>";            //2023-04            $yyyy_mm=$yyyy."-".$mm1;            $i=$i+1;            if($i==1) {                $vurl = "&property[0][property]=23&property[0][type]=in&&property[0][text]=" . $yyyy_mm;            }else{                $vurl=$vurl."&property[".$j."][joiner]=or&property[".$j."][property]=23&property[".$j."][type]=in&property[".$j."][text]=".$yyyy_mm;            }            $j=$j+1;        }        //http://ec2-18-139-29-204.ap-southeast-1.compute.amazonaws.com/admin/item?property[0][joiner]=and&property[0][property]=23        //http://ec2-18-139-29-204.ap-southeast-1.compute.amazonaws.com/admin/item?property[0][joiner]=and        //&property[0][property]=23 // ค้นหาจาก วันที่เผยแพร่ dcterms:issued        //&property[0][type]=in        //&property[0][text]=2023-04        //&property[1][joiner]=or        //&property[1][property]=23        //&property[1][type]=in        //&property[1][text]=2023-05        //&property[2][joiner]=or        //&property[2][property]=23        //&property[2][type]=in        //&property[2][text]=2023-06        //&site_id=1&sort_by=created&sort_order=desc&datetime[0][joiner]=and&datetime[0][field]=created&datetime[0][type]=gte&datetime[0][value]=&datetime[0][joiner]=and&datetime[0][field]=created&datetime[0][type]=gte&datetime[0][value]=&is_public=1&has_media=&has_original=&has_thumbnails=&has_tags=0        // &resource_template_id[]=2 =>Template ชุดเมทาดาทาศาสตราจารย์นายแพทย์ประเวศ วะสี //Date Issued contains 2023-04 OR Date Issued contains 2023-05 Template ชุดเมทาดาทาศาสตราจารย์นายแพทย์ประเวศ วะสี        $resource_template="&resource_template_id[]=2";        $vurl=$vurl."&site_id=1&sort_by=created&sort_order=desc&datetime[0][joiner]=and&datetime[0][field]=created&datetime[0][type]=gte&datetime[0][value]=&datetime[0][joiner]=and&datetime[0][field]=created&datetime[0][type]=gte&datetime[0][value]=&is_public=1&has_media=&has_original=&has_thumbnails=&has_tags=0".$resource_template;        // $api_url_count = $vomekas_url."infos?property[0][joiner]=and" .$vurl;        $api_url = $vomekas_url."items?property[0][joiner]=and" .$vurl."&page=1&per_page=".$vlimitpermonth;        //     echo $api_url;        //   exit();        //  $api_url=$vomekas_url."items?property[0][joiner]=and&property[0][property]=23&property[0][type]=in&property[0][text]=".$YYYY_MM."&sort_by=created&sort_order=desc&datetime[0][field]=created&datetime[0][type]=gte&datetime[0][field]=created&datetime[0][type]=gte".$vper_page;        $json_objekat    = cal_curl_api($api_url);        if(!empty($json_objekat)) {            foreach ($json_objekat as $objQuote) {                $title=$objQuote->o_title;                $o_id=$objQuote->o_id;                //  $dcterms_date=$objQuote->dcterms_date; //วันที่สร้างเอกสาร                $thumbnail="";                //part รูป                if(isset($objQuote->thumbnail_display_urls)){                    $thumbnail_arr=$objQuote->thumbnail_display_urls;                    if(!empty($thumbnail_arr)){                        $thumbnail_url=$thumbnail_arr->large;                        $thumbnail = $thumbnail_url;                    }                }                //cat Collection                $catesArray= array();                $catesNameArray= array();                if(isset($objQuote->o_item_set)){                    $item_set_arr=$objQuote->o_item_set;                    if(!empty($item_set_arr)){                        foreach ($item_set_arr as $item_set) {                            $vid_set=$item_set->o_id;                            array_push($catesArray, $vid_set);                            /* $item_set_id=$vid_set;                             $api_url2=$vomekas_url."item_sets/".$item_set_id;                             $json_objekat2    = cal_curl_api($api_url2);                             if(!empty($json_objekat2)) {                                 array_push($catesNameArray, $json_objekat2->o_title);                             }*/                            // echo "<pre>999=";                            //  print_r($item_set);                            //  echo "</pre>";                            // $api_url_item_set=$vomekas_url."item_sets/".$vid_set;                            // $json_obj_cate=cal_curl_api($api_url_item_set);                        }                    }                }                if(isset($objQuote->dcterms_coverage)){                    $dcterms_coverage_arr=$objQuote->dcterms_coverage;                    if(!empty($dcterms_coverage_arr)){                        foreach ($dcterms_coverage_arr as $item_coverage) {                            array_push($catesNameArray, trim($item_coverage->a_value));                        }                    }                }                //วันที่ สร้างเอกสาร                $dcterms_dateArray= array();                $dcterms_date= $config["nd"];                if(isset($objQuote->dcterms_date)){                    $dcterms_date_arr=$objQuote->dcterms_date;                    if(!empty($dcterms_date_arr)){                        foreach ($dcterms_date_arr as $date_set) {                            //array_push($dcterms_dateArray, $vdcterms_date);                            $dcterms_date = trim($date_set->a_value);                            $dcterms_date=convert_date_yyyy_mm_dd($dcterms_date);                        }                    }                }                //ผู้สร้าง/เจ้าของผลงาน                $dcterms_creator= $config["nd"];                if(isset($objQuote->dcterms_creator)){                    $dcterms_creator_arr=$objQuote->dcterms_creator;                    if(!empty($dcterms_creator_arr)){                        foreach ($dcterms_creator_arr as $date_set) {                            $dcterms_creator=trim($date_set->a_value);                            //array_push($dcterms_dateArray, $vdcterms_date);                        }                    }                }                $data=array(                    "id"=>$o_id,                    "thumbnail"=>$thumbnail,                    "cates"=>$catesArray,                    "catenames"=>$catesNameArray,                    "title"=>$title,                    "created"=>$dcterms_date,                    'creator'=>$dcterms_creator                );                array_push($dataArray, $data);            }        }        if(empty($dataArray)){            $response = ['n.d.'];//            $data = array(//                'result' => 1,//                'array_quiz_answers' => $array_quiz_answers,//            );            echo json_encode($response);            exit();        }        echo json_encode($dataArray);    }else{        echo json_encode(['status' => 'error','message' => 'Error']);    }}?><?phpexit();echo "<br>===================";echo "<br>คลังข้อมูลดิจิทัล";$psru_q="การผลิต";$psru_per_page="&page=1&per_page=16";$psru_api_url= "http://202.29.80.66/onesearch/api/items?search=".$psru_q.$psru_per_page;$psru_api_url="http://ec2-18-139-29-204.ap-southeast-1.compute.amazonaws.com/api/items?item_set_id=15&page=1&per_page=50";$curl = curl_init($psru_api_url);curl_setopt($curl, CURLOPT_URL, $psru_api_url);curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);$headers = array(    "REST-API-Key: 1111",);curl_setopt($curl, CURLOPT_HTTPHEADER, $headers);//for debug only!curl_setopt($curl, CURLOPT_SSL_VERIFYHOST, false);curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, false);$resp = curl_exec($curl);curl_close($curl);//var_dump($resp);$words_f = ["o:", "dcterms:", ":tag", "o-module-folksonomy", "@value"];$words_r   = ["o_", "dcterms_", "_tag", "o_module_folksonomy", "a_value"];$resp = str_replace($words_f,$words_r,$resp);//$resp = str_replace("o:","o-",$resp);$json_objekat    = json_decode($resp);//echo "<hr>";//echo $psru_api_url."<br>";$data=[];$myArray= array();$psruCollecArray= array();if(!empty($json_objekat)) {foreach ($json_objekat as $objQuote) {    $object = new stdClass();    $object->id = "";    $object->title = "";    $object->subject = "";    $object->description = "";    $object->tag = "";    $object->abstract = "";//    echo "<pre>999=";//    print_r($objQuote);//    echo "</pre>";//    echo "<hr>";   /// $objj1= $objQuote[1];    $o_id=$objQuote->o_id;    $object->id = $o_id;//ชื่อเรื่องหนังสือ    $o_title=$objQuote->o_title;    $object->title = $o_title;  // print_r($objj1); //  echo "ชื่อเรื่องหนังสือ=".$o_title; //   echo "<br>";   // หัวเรื่อง dcterms:subject    if(isset($objQuote->dcterms_subject)){        $subject_arr=$objQuote->dcterms_subject;        if(!empty($subject_arr)){            $vsubject="";            foreach ($subject_arr as $subject) {                $vsubject=$vsubject.$subject->a_value.",";            }         //   echo "หัวเรื่อง=".$vsubject;         //   echo "<br>";            $object->subject =$vsubject;        }    }    // print_r($objj1);    //description    // print_r($objj1);    if(isset($objQuote->dcterms_description)){        $description_arr=$objQuote->dcterms_description;        if(!empty($description_arr)){            $vdescription="";            foreach ($description_arr as $description) {                $vdescription=$vdescription.$description->a_value;            }            $object->description = $vdescription;          //  echo "description=".$vdescription;          //  echo "<br>";        }    }    //tag    if(isset($objQuote->o_module_folksonomy_tag)){        $tag_arr=$objQuote->o_module_folksonomy_tag;        if(!empty($tag_arr)){            $vtag="";            foreach ($tag_arr as $tag) {                $vtag=$vtag.$tag->o_id.",";            }            $object->tag = $vtag;          //  echo "tag=".$vtag;          //  echo "<br>";        }    }    //abstract    if(isset($objQuote->dcterms_abstract)){        $abstract_arr=$objQuote->dcterms_abstract;        if(!empty($abstract_arr)){            //  $vtag="";            foreach ($abstract_arr as $abstract) {                // echo "tag=".$tag->o_id;                $abstract_value=$abstract->a_value.",";           //     echo "abstract=".$abstract_value;            //    echo "<br>";            }            //  echo "tag=".$vtag;            // echo "<br>";            $object->abstract = $abstract_value;        }    }    array_push($psruCollecArray, $object);}}//echo "<pre>psruCollecArray=";//print_r($psruCollecArray);//echo "</pre>========";//echo "<pre>";//print_r($json_objekat);//echo "</pre>";$i=0;//===============================================echo "<table style='border-collapse: collapse;border: 1px solid black;'>  <tr>    <th>ลำดับ</th>    <th>ID</th>    <th>หัวเรื่อง</th>    <th>ชื่อเรื่อง</th>    <th>tag</th>     <th>Abstract</th>     <th>Description</th>  </tr>";  foreach ($psruCollecArray as $item) {      $i=$i+1;      echo "<tr><td width='10'>".$i.".</td><td width='50'>".$item->id."</td><td width='500'>".$item->title."</td><td width='300'>".$item->subject."</td><td width='400'>".$item->tag."</td><td width='600'>".$item->abstract."</td><td width='600'>".$item->description."</td></tr>";  }echo "</table>";?><style>table, th, td {  border: 1px solid black;  border-collapse: collapse;}</style><?php//======================================/*echo "<br>===================";echo "<br>มาหาวิทยาลัยราชภัฏกำแพงเพชร";$kpru_q="วัดบ่อ";$kpru_per_page="&page=1&per_page=16";$kpru_api_url= "https://arit.kpru.ac.th/ap2/local/api.php?nu=qItems&q=".$kpru_q."&Token=S2FtcGhhZW5nIFBoZXQgUmFqYWJoYXQgVW5pdmVyc2l0eQ==";$curl = curl_init($kpru_api_url);curl_setopt($curl, CURLOPT_URL, $kpru_api_url);curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);$headers = array(    "Token: S2FtcGhhZW5nIFBoZXQgUmFqYWJoYXQgVW5pdmVyc2l0eQ==",);curl_setopt($curl, CURLOPT_HTTPHEADER, $headers);//for debug only!curl_setopt($curl, CURLOPT_SSL_VERIFYHOST, false);curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, false);$resp = curl_exec($curl);curl_close($curl);//var_dump($resp);//random array//var_dump($resp);$json_objekat    = json_decode($resp);echo "<hr>";echo $kpru_api_url."<br>";//echo "<pre>";//print_r($json_objekat);//echo "</pre>";$kpruCollecArray= array();$item_show_main=3; //กำหนดแสดง จำนวนรายการต่อ collection//$link="https://arit.kpru.ac.th/ap2/local/?nu=pages&page_id=2179&code_db=610009&code_type=01";$link="https://arit.kpru.ac.th/ap2/local/?nu=pages&page_id=";foreach($json_objekat as $objQuote) {    echo "<pre>kpruCollecArray=";    print_r($objQuote);    echo "</pre>========";    $object = new stdClass();    $object->id =$objQuote->id;    $object->title =$objQuote->title;    $object->subject= $objQuote->info;    $object->date =$objQuote->date_time;    $object->publisher =$objQuote->org;    $object->creator ="";    $object->link =$link.$objQuote->id."&code_db=".$objQuote->code_db."&code_type=".$objQuote->code_type;    $object->images =$objQuote->images;     array_push($kpruCollecArray, $object);}echo "<pre>kpruCollecArray=";print_r($kpruCollecArray);echo "</pre>========";*/?>